(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-issue-issue"],{2304:function(t,e,n){var i=n("e24d");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=n("4f06").default;o("6cd5ecda",i,!0,{sourceMap:!1,shadowMode:!1})},"48d4":function(t,e,n){"use strict";n.r(e);var i=n("d986"),o=n("8cfc");for(var a in o)"default"!==a&&function(t){n.d(e,t,function(){return o[t]})}(a);n("9d15");var s=n("2877"),l=Object(s["a"])(o["default"],i["a"],i["b"],!1,null,"2a928c5e",null);e["default"]=l.exports},"8cfc":function(t,e,n){"use strict";n.r(e);var i=n("b053"),o=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);e["default"]=o.a},"9d15":function(t,e,n){"use strict";var i=n("2304"),o=n.n(i);o.a},b053:function(t,e,n){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o={data:function(){return{title:"",artList:[],inputContent:"",needUploadImg:[],uploadIndex:0,caties:["点击选择"],currentCateIndex:0,catiesFromApi:[],sedCateIndex:0,imgUrl:[],token:""}},onLoad:function(){i=this,this.getoken()},methods:{getoken:function(){this.token=uni.getStorageSync("userToken")},submitNow:function(){this.title.length<1?uni.showToast({title:"请输入内容",icon:"none"}):uni.request({url:"http://deve.tianlwl.com/api.html&method=pages.addmoments",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{title:i.title,images:i.imgUrl,token:i.token},success:function(t){console.log(123),console.log(t),console.log(i.imgUrl),t.data.status?(uni.showToast({title:"提交成功",icon:"none"}),setTimeout(function(){uni.switchTab({url:"../ring/index"})},1e3)):(console.log("失败了"),console.log(t),uni.showToast({title:t.data.msg,icon:"none"}))}})},addImg:function(){uni.chooseImage({success:function(t){uni.showLoading({title:"加载中"});var e=t.tempFilePaths;uni.uploadFile({url:"http://deve.tianlwl.com/api.html",filePath:e[0],fileType:"image",name:"file",headers:{Accept:"application/json","Content-Type":"multipart/form-data"},formData:{method:"images.upload",upfile:e[0]},success:function(t){t=JSON.parse(t.data);if(console.log(t),t.status){console.log(1);var e=t.data.url;i.imgUrl.push(e),console.log(i.imgUrl)}},fail:function(t){t&&t.response&&showError(t.response)},complete:function(){setTimeout(function(){uni.hideLoading()},250)}})}})},cateChange:function(t){var e=t.detail.value;if(this.currentCateIndex=e,!(e<1)){var n=this.caties[e];for(var i in this.catiesFromApi)if(n==this.catiesFromApi[i]){this.sedCateIndex=i;break}this.currentCateIndex=e}},removeImg:function(t){console.log(t);var e=t.currentTarget.dataset.index;uni.showModal({content:"确定要删除此图片吗",title:"提示",success:function(t){t.confirm&&i.imgUrl.splice(e,1)}})},deleteText:function(t){var e=t.currentTarget.dataset.index;uni.showModal({content:"确定要删除吗",title:"提示",success:function(t){t.confirm&&i.artList.splice(e,1)}})},submitNow1:function(){if(this.submit(this.inputContent),this.inputContent<1)uni.showToast({title:"请写文章内容",icon:"none"});else if(this.artList.length<2)uni.showToast({title:"请添加图片",icon:"none"});else{this.needUploadImg=[];for(var t=0;t<this.artList.length;t++)"image"==this.artList[t].type&&this.needUploadImg.push({tmpurl:this.artList[t].content,indexID:t});console.log("需要上传图片内容列表:"+this.needUploadImg),this.uploadImg()}},uploadImg:function(){if(this.needUploadImg.length<1||this.uploadIndex>=this.needUploadImg.length)uni.showLoading({title:"正在提交"}),uni.request({url:"http://deve.tianlwl.com/api.html&method=pages.addmoments",method:"POST",data:{title:i.title},success:function(t){},fail:function(){},complete:function(){}});else{uni.showLoading({title:"上传图片"}),console.log("needuploading"),console.log(this.needUploadImg);uni.uploadFile({url:"http://deve.tianlwl.com/api.html&method=pages.addmoments",filePath:i.needUploadImg[i.uploadIndex].tmpurl,name:"file",success:function(t){if(console.log(t),t=JSON.parse(t.data),"ok"!=t.status)return uni.showToast({title:"上传图片失败,请重试!",icon:"none"}),!1;var e=i.needUploadImg[i.uploadIndex].indexID;i.artList[e].content=i.staticServer+t.data,i.uploadIndex++,setTimeout(function(){i.uploadImg()},1e3)},fail:function(t){console.log(t),uni.showToast({title:"上传图片失败,请重试!",icon:"none"})}})}},submit:function(t){console.log(t);for(var e=0;e<this.artList.length;e++)"text"==this.artList[e].type&&this.artList.splice(e,1);this.artList.push({type:"text",content:t}),console.log(this.artList)},addImg1:function(){uni.chooseImage({count:1,sizeType:["compressed"],success:function(t){i.artList.push({type:"image",content:t.tempFilePaths[0]})}})}}};e.default=o},d986:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"wrap"},[n("v-uni-form",{on:{submit:function(e){e=t.$handleEvent(e),t.submit(t.inputContent)}}},[n("v-uni-view",{staticClass:"inputArea clearfix"},[n("v-uni-view",{staticClass:"addText"},[n("v-uni-textarea",{staticClass:"textarea",attrs:{name:"artText",maxlength:"-1",placeholder:"这一刻的想法..."},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),n("v-uni-view",{staticClass:"addImgBox"},[t._l(t.imgUrl,function(e,i){return[t.imgUrl?n("v-uni-view",{key:i+"_0",staticClass:"item"},[n("v-uni-image",{attrs:{src:e,"data-index":i,mode:"aspectFill"},on:{click:function(e){e=t.$handleEvent(e),t.removeImg(e)}}})],1):t._e()]}),n("v-uni-view",{staticClass:"addImg",on:{click:function(e){e=t.$handleEvent(e),t.addImg(e)}}},[t._v("+")])],2)],1)],1),n("v-uni-view",{staticClass:"submitNow",on:{click:function(e){e=t.$handleEvent(e),t.submitNow(e)}}},[t._v("发布文章")])],1)},o=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return o})},e24d:function(t,e,n){e=t.exports=n("2350")(!1),e.push([t.i,".issue[data-v-2a928c5e]{width:100%;margin:0 auto}.issue .write_title[data-v-2a928c5e]{width:90%}.issue .write_title uni-input[data-v-2a928c5e]{border:1px solid #000}",""])}}]);